#!/bin/bash
cd ~/boolector
make clean
./configure -r
make merge
rm -r -f doc
doxygen
version=`cat VERSION`
target=/tmp/boolector-$version
rm -r -f $target
mkdir $target
mkdir ${target}/bin
mkdir ${target}/lib
mkdir ${target}/include
mkdir ${target}/examples
cp README $target
cp LICENSE $target
cp boolector ${target}/bin
cp libboolector.a ${target}/lib
sed -e 's/#include "btorexp.h"/typedef struct BtorExp BtorExp;\ntypedef struct Btor Btor;/g' boolector.h > ${target}/include/boolector.h
cp -r doc $target

# copy and adapt examples
for dir in bv array
do
  mkdir ${target}/examples/$dir
  echo 'LIBPATH=../../lib' > ${target}/examples/${dir}/makefile
  sed -n '2,$p' examples/${dir}/makefile >> ${target}/examples/${dir}/makefile
  num=`ls examples/${dir}/*.c | wc -l`
  for ((i = 1; i <= $num; i++))
  do
    file=${dir}${i}.c
    echo '#include "../../include/boolector.h"' > ${target}/examples/${dir}/$file
    sed -n '2,$p' examples/${dir}/$file >> ${target}/examples/${dir}/$file
  done
done
