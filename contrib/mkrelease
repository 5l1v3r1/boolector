#!/bin/bash
cd `dirname $0`
cd ..
cd ../picosat || exit 1
./configure -O || exit 1
make
cd ../boolector
./configure -r || exit 1
make merge
version=`cat VERSION`
target=/tmp/boolector-$version
rm -r -f $target
mkdir $target
mkdir ${target}/bin
mkdir ${target}/lib
mkdir ${target}/include
mkdir ${target}/examples
cp README $target
cp LICENSE $target
cp boolector ${target}/bin
cp libboolector.a ${target}/lib

#copy and adapt public interface header file
sed -e 's/#include "btorexp.h"/typedef struct BtorExp BtorExp;\ntypedef struct Btor Btor;/g' boolector.h > ${target}/include/boolector.h

# copy and adapt examples
for dir in bv array
do
  mkdir ${target}/examples/$dir
  echo 'LIBPATH=../../lib' > ${target}/examples/${dir}/makefile
  sed -n '2,$p' examples/${dir}/makefile >> ${target}/examples/${dir}/makefile
  num=`ls examples/${dir}/*.c | wc -l`
  for ((i = 1; i <= $num; i++))
  do
    file=${dir}${i}.c
    echo '#include "../../include/boolector.h"' > ${target}/examples/${dir}/$file
    sed -n '2,$p' examples/${dir}/$file >> ${target}/examples/${dir}/$file
  done
done

#generate documentation
sed -e 's/boolector\.h/include/g' Doxyfile > ${target}/Doxyfile
cd $target
doxygen
rm Doxyfile
