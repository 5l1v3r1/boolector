#!/bin/bash

die () 
{
  echo "*** crosscheckboolector: $*" 1>&2
  exit 1
}

trap "exit" SIGHUP SIGINT SIGTERM

btor_test=""
btor_ref=""

while [ $# -gt 0 ]
do
  case $1 in
    -h|--help)
      echo "usage: $(basename $0) [<option>] <test> <ref> <file>"
      echo
      echo "  <test>: the solver instance under test (default: boolector)"
      echo "  <ref>:  the reference solver instance (default: <test> -nrw)"
      echo
      echo "  options:"
      echo "    -h, --help    print this message and exit"
      echo
      exit
      ;;
    *) 
      if [ x"$btor_test" = x ]; then
	btor_test=$1
      elif [ x"$btor_ref" = x  ]; then
	btor_ref=$1
      else
	break
      fi
      ;;
  esac
  shift
done

inputfile="$*"

[ x"$inputfile" = x ] && die "inputfile missing"

$btor_ref $inputfile > /dev/null 2>&1
expected_result=$?
#echo "$btor_ref"
#echo "expected result: $expected_result"

$btor_test $inputfile > /dev/null 2>&1
result=$?
#echo "$btor_test"
#echo "result: $result"

# we do not want assertions errors for now
if [[ $result != 10 && $result != 20 ]]; then
  exit 0
fi

if [ $result -eq $expected_result ]; then
  exit 0
else
  exit 1
fi
