#!/bin/bash

# run testbtorbtorgen on multiple cores simultaneously

cores=4
sleeptime=10
fileids="/tmp/testmcbtorbtorgen$$.pids"

function cleanup
{
  cat $fileids | while read line; 
  do 
    kill $line 
  done
}

for ((i = 1; i <= $cores; i++))
do
  ./testbtorbtorgen "./error$i" > /dev/null &
  if [[ $i -eq 1 ]]; then
    echo $! > $fileids
  else
    echo $! >> $fileids
  fi
  sleep 1
done

trap "cleanup; exit" SIGHUP SIGINT SIGTERM

while true
do
  sleep $sleeptime 
  errors=error*.btor
  echo "Errors: "`ls $errors 2> /dev/null | wc -l`
done

