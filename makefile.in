.SUFFIXES: .o .c
.c.o:
	$(CC) $(CFLAGS) -c $<
SHELL=/bin/sh
VERSION=$(shell cat VERSION)
PICOSATOBJ=../picosat/picosat.o ../picosat/version.o @PICOPREP_OBJS@ 
LIBOBJ= \
  $(addsuffix .o,$(basename $(wildcard btor*.c))) \
  boolector.o $(PICOPREP_OBJS)
TESTOBJ=$(addsuffix .o,$(basename $(wildcard test*.c)))
CC=@CC@
CFLAGS=@CFLAGS@
LIBS=@LIBS@

all: libboolector.a boolector test synthebtor deltabtor basicbtor

-include dependencies

dependencies: btorconfig.h *.c *.h makefile
	rm -f $@; $(CC) $(CFLAGS) -MM *.c|sed -e 's,:,: makefile,'>$@
boolector: boolectormain.o libboolector.a
	$(CC) $(CFLAGS) -o $@ boolectormain.o -L. -lboolector $(LIBS)@STRIP@
merged.c: btorconfig.h *.c *.h makefile contrib/merge
	./contrib/merge
merged.o: merged.c
	$(CC) $(CFLAGS) -c merged.c
merged: boolectormain.o merged.o
	$(CC) $(CFLAGS) -o $@ boolectormain.o merged.o \
	  $(PICOSATOBJ) $(LIBS)@STRIP@
test: $(TESTOBJ) libboolector.a 
	$(CC) $(CFLAGS) -o $@ $(TESTOBJ) -L. -lboolector $(LIBS)@STRIP@

synthebtor: synthebtor.o libboolector.a
	$(CC) $(CFLAGS) -o $@ synthebtor.o -L. -lboolector $(LIBS)@STRIP@

deltabtor: deltabtor.c makefile
	$(CC) $(CFLAGS) -o $@ deltabtor.c@STRIP@

basicbtor: basicbtor.c makefile
	$(CC) $(CFLAGS) -o $@ basicbtor.c@STRIP@

libboolector.a: $(LIBOBJ)
	ar rc $@ $(LIBOBJ)
	ranlib $@

btorconfig.h: makefile VERSION mkconfig
	rm -f $@; ./mkconfig > $@

clean:
	rm -f test boolector deltabtor synthebtor basicbtor
	rm -f *.o *.a
	rm -f *.gcda *.gcno *.gcov 
	rm -f log/*.log
	rm -f dependencies
	rm -f *.tmp
	rm -f makefile
	rm -f btorconfig.h
	rm -f merged.c

.PHONY: all clean
