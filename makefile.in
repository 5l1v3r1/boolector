SHELL=/bin/sh
VERSION=$(shell cat VERSION)
LIBOBJ=$(addsuffix .o,$(basename $(wildcard btor*.c))) ../picosat/picosat.o
TESTOBJ=$(addsuffix .o,$(basename $(wildcard test*.c)))
CC=@CC@
CFLAGS=@CFLAGS@

all: libboolector.a boolector test synthebtor deltabtor

-include dependencies

dependencies: *.c *.h makefile
	rm -f $@; $(CC) $(CFLAGS) -MM *.c|sed -e 's,:,: makefile,'>$@

boolector: boolector.o libboolector.a
	$(CC) $(CFLAGS) -o $@ boolector.o -L. -lboolector

test: $(TESTOBJ) ../picosat/picosat.o libboolector.a 
	$(CC) $(CFLAGS) -o $@ $(TESTOBJ) -L. -lboolector

synthebtor: synthebtor.o libboolector.a
	$(CC) $(CFLAGS) -o $@ synthebtor.o -L. -lboolector

deltabtor: deltabtor.c makefile
	$(CC) $(CFLAGS) -o $@ deltabtor.c

libboolector.a: $(LIBOBJ)
	ar rc $@ $(LIBOBJ)
	ranlib $@

btorconfig.h: makefile VERSION mkconfig
	rm -f $@; ./mkconfig > $@

clean:
	rm -f test boolector deltabtor synthebtor
	rm -f *.o *.a
	rm -f *.gcda *.gcno *.gcov 
	rm -f log/*.log
	rm -f dependencies
	rm -f *.tmp
	rm -f makefile
	rm -f btorconfig.h

.PHONY: all clean
