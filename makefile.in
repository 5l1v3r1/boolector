SHELL=/bin/sh
VERSION=$(shell cat VERSION)
LIBOBJ=$(addsuffix .o,$(basename $(wildcard btor*.c))) ../picosat/picosat.o ../picosat/version.o @PICOPREP_OBJS@ 
TESTOBJ=$(addsuffix .o,$(basename $(wildcard test*.c)))
CC=@CC@
CFLAGS=@CFLAGS@
LIBS=@LIBS@

all: libboolector.a boolector test synthebtor deltabtor basicbtor

-include dependencies

dependencies: btorconfig.h *.c *.h makefile
	rm -f $@; $(CC) $(CFLAGS) -MM *.c|sed -e 's,:,: makefile,'>$@

boolector: boolector.o libboolector.a
	$(CC) $(CFLAGS) -o $@ boolector.o -L. -lboolector $(LIBS)

test: $(TESTOBJ) libboolector.a 
	$(CC) $(CFLAGS) -o $@ $(TESTOBJ) -L. -lboolector $(LIBS)

synthebtor: synthebtor.o libboolector.a
	$(CC) $(CFLAGS) -o $@ synthebtor.o -L. -lboolector $(LIBS)

deltabtor: deltabtor.c makefile
	$(CC) $(CFLAGS) -o $@ deltabtor.c

basicbtor: basicbtor.c makefile
	$(CC) $(CFLAGS) -o $@ basicbtor.c

libboolector.a: $(LIBOBJ)
	ar rc $@ $(LIBOBJ)
	ranlib $@

btorconfig.h: makefile VERSION mkconfig
	rm -f $@; ./mkconfig > $@

clean:
	rm -f test boolector deltabtor synthebtor basicbtor
	rm -f *.o *.a
	rm -f *.gcda *.gcno *.gcov 
	rm -f log/*.log
	rm -f dependencies
	rm -f *.tmp
	rm -f makefile
	rm -f btorconfig.h

.PHONY: all clean
