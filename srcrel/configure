#!/bin/sh

debug=no
precosat=no
lingeling=no

die () {
  echo "*** configure: $*" 1>&2
  exit 1
}

while [ $# -gt 0 ]
do
  case $1 in
    -h) echo "usage: configure [-h][-g][-precosat][-lingeling]"; exit 0;;
    -g) debug=yes;;
    -precosat) precosat=yes;;
    -lingeling) lingeling=yes;;
    -*) die "invalid command line option '$1' (try '-h')";;
  esac
  shift
done

check () {
 [ -f $1 ] || die "can not find '$1'" 
}

check ../picosat/picosat.h
check ../picosat/version.o
check ../picosat/picosat.o
echo "PicoSAT backend"

CC=gcc
CFLAGS=-Wall
if [ $debug = yes ]
then
  CFLAGS="$CFLAGS -g"
else
  CFLAGS="$CFLAGS -O3 -DNDEBUG"
fi

if [ $precosat = yes ]
then
  check ../precosat/precosat.hh
  check ../precosat/precosat.o
  check ../precosat/precobnr.o
  CFLAGS="$CFLAGS -DBTOR_USE_PRECOSAT"
  OBJS="btorpreco.o ../precosat/precosat.o ../precosat/precobnr.o"
  LIBS="-lz -lstdc++"
  echo "PrecoSAT backend"
fi

if [ $lingeling = yes ]
then
  check ../lingeling/lglib.h
  check ../lingeling/liblgl.a
  [ x"$CFLAGS" = x ] || CFLAGS="${CFLAGS} "
  [ x"$LIBS" = x ] || LIBS="${LIBS} "
  CFLAGS="${CFLAGS}-DBTOR_USE_LINGELING"
  LIBS="${LIBS}-L../lingeling -llgl -lm"
fi

rm -f makefile
sed \
-e "s,@CC@,$CC," \
-e "s,@CFLAGS@,$CFLAGS," \
-e "s,@LIBS@,$LIBS," \
-e "s,@OBJS@,$OBJS," \
makefile.in > makefile

echo "generated makefile"
echo "run 'make' or 'make install'"
